<%- include('../layouts/header') %>

<% if (typeof userData !== 'undefined') { %>
<%- include('../layouts/userHeaderLogged') %>
<% } else { %>
<%- include('../layouts/userHeader') %>
<% } %>


<!-- <section class="shop_section layout_padding">
  <div class="heading_container mt-5">
     <h2>
      Latest Products
     </h2>
  </div> -->
<section class="shop_section layout_padding col-sm-12 col-md-12 col-lg-9 col-xl-9 mt-5  " id="latest-proucts">
  <div class="container pt-5">

    <div class="heading_container heading_center" id="latest-products-heading">

      <h2 id="latest-products-heading">LATEST PRODUCTS</h2>

    </div>
    <div class="row ms-5 ps-5">
      <% products.forEach(function(product) { %>
      <div class="col-sm-6 col-md-4 col-lg-3">
        <div class="box shadow-lg" style="background-color: <%= product.bgColor %>">

          <a>
            <button onclick="addToCart('<%= product._id %>')" class="btn position-absolute start-75 end-0 bg-light rounded-circle mt-1 me-1 shadow me-5" style="color: brown" data-bs-toggle="modal" data-bs-target="#addToCartModal">
              <i class="fa-solid fa-shopping-bag" aria-hidden="true"></i>
            </button>
            <button onclick="wishlistClick('<%= product._id %>')" class="btn position-absolute start-75 end-0 bg-light rounded-circle mt-1 me-1 shadow " style="color:brown">
              <i class="fa-solid fa-heart" area-hidden="true"></i>
            </button>
          </a>
          <a href="/productView?id=<%= product._id %>">
            <div class="img-box">
              <img src="/images/<%= product.img1 %>" alt="">
            </div>
            <% if (product.__v === 0) { %>
            <div class="new">
              <span>
                new
              </span>
            </div>
            <% } %>

            <!-- <div class="new2">
            
          </div>  -->

          </a>
        </div>
        <div class="mt-2 detail-box">
          <h6>
            <%= product.productName %>
          </h6>
          <h6 style="font-size:1rem">
            Price
            <span>
              â‚¹<%= product.price %>
            </span>
          </h6>
          <div class="btn-box d-flex flex-row">
            <a href="/productView?id=<%= product._id %>" class="btn shadow-sm">
              Explore
            </a>
          </div>
        </div>
      </div>


      <div class="modal fade" id="addToCartModal" tabindex="-1" aria-labelledby="addToCartModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addToCartModalLabel">Add to Cart</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <p>Select the size:</p>
              <div class="form-group">
                <select class="form-select" id="productSize">
                  <option value="5">Size 5</option>
                  <option value="6">Size 6</option>
                  <option value="7">Size 7</option>
                  <option value="8">Size 8</option>
                  <option value="9">Size 9</option>
                </select>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" onclick="addToCartWithSize('<%= product._id %>','<%=product.stock%>')">Add to Cart</button>
            </div>
          </div>
        </div>
      </div>

      <% }); %>
    </div>
</section>





<%-include('../layouts/footer')%>


<script>
  function addToCartWithSize(data, stock) {
    const size = document.getElementById("productSize").value;

    const id = data;
    fetch("/user/addtoCart", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          id: id,
          size: size
        })
      })
      .then(response => {
        console.log(response);
        return response.json();
      })
      .then(data2 => {
        console.log(data2);
        if (data2 === "login") {
          window.location.href = "/login";
        } else if (data2 === "added") {
          Swal.fire({
            title: 'Product added to cart!',
            text: 'Do you want to go to the cart?',
            icon: 'success',
            showCancelButton: true,
            confirmButtonText: 'Yes, go to cart',
            cancelButtonText: 'No, continue shopping',
            reverseButtons: true,
            customClass: {
              confirmButton: 'my-confirm-button-class',
              cancelButton: 'my-cancel-button-class',
              title: 'my-title-class',
              content: 'my-content-class'

            }
          }).then((result) => {
            if (result.isConfirmed) {
              window.location.href = "/cart?id=<%= userData._id %>";
            }
          });
        } else {
          Swal.fire({
            title: 'Cart updated successfully!',
            text: 'Do you want to go to the cart?',
            icon: 'success',
            showCancelButton: true,
            confirmButtonText: 'Yes, go to cart',
            cancelButtonText: 'No, continue shopping',
            reverseButtons: true,
            customClass: {
              confirmButton: 'my-confirm-button-class',
              cancelButton: 'my-cancel-button-class',
              title: 'my-title-class',
              content: 'my-content-class'
            }
          }).then((result) => {
            if (result.isConfirmed) {
              window.location.href = "/cart?id=<%= userData._id %>";
            } else {
              console.log("hai");
              window.location.href = "/user";
            }
          });
        }
      })
      .catch(error => {
        console.log(error);
      });
  }
</script>